<title>WM panel</title>
<link rel="stylesheet" href="ui.css">
<script src="util.js"></script>
<!-- Have some auth that we send to server to verify in some gitignore dot file. Then expose creating a team, setting members of team, generating matches, inputting results, penalties -->
<div id="maindiv"></div>
<script>
function requestAuth(pass){
	xhrSend("wmlogin?auth="+encodeURIComponent(pass), createPanel, createLoginForm);
}
function createLoginForm(){
	clearDiv(maindiv);
	var input = document.createElement("input");
	input.placeholder="auth";
	input.addEventListener("keydown", function(e){
		if (e.keyCode == 13){
			localStorage.auth = input.value;
			requestAuth(input.value);
		}
	});
	maindiv.appendChild(input);
}
function createPanel(){
	clearDiv(maindiv);
	var result = JSON.parse(this.responseText);
	var makeTeamEle = document.createElement("input");
	var makeTeamSize = document.createElement("input");
	var makeTeam = document.createElement("input");
	makeTeamEle.placeholder = "E";
	makeTeamSize.placeholder = "Size";
	makeTeam.type = "button";
	makeTeam.value = "Create Team";
	makeTeam.addEventListener("click", function(){
		xhrSend("createteam?"+mkQuery({auth:localStorage.auth, e:makeTeamEle.value, s:makeTeamSize.value}));
	});
	var viewMatches = document.createElement("a");
	viewMatches.href = "#";
	viewMatches.addEventListener("click", function(){
		xhrSend("viewmatches", createMatchView);
	});
	maindiv.appendChild(makeTeamEle);
	maindiv.appendChild(makeTeamSize);
	maindiv.appendChild(makeTeam);
	maindiv.appendChild(document.createElement("br"));
	maindiv.appendChild(viewMatches);
}
function createMatchView(){
	clearDiv(maindiv);
	var matches = JSON.parse(this.responseText);
	matches.forEach(function(match){
		var team1 = match&15, mem1 = (match>>4)&15, team2 = (match>>8)&15, mem2 = match>>12;
		maindiv.appendChild(document.createTextNode(team1 + ":" + mem1 + " vs " + team2 + ":" + mem2));
		//TODO include result input
		maindiv.appendChild(document.createElement("br"));
	});
}
requestAuth(localStorage.auth); // Could skip straight to createLoginForm if auth doesn't exist, but I'd rather write this comment
</script>